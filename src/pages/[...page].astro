---
import type { GetStaticPaths } from "astro";
import Layout from "../layouts/Layout.astro";
import DevlogEntry from "../components/DevlogEntry.astro";
import Sidebar from "../components/Sidebar.astro";
import {getCollection, type CollectionEntry} from "astro:content";


// splits the content collection into chunks and makes new pages for those chunks.
export const getStaticPaths = async () => {
	const posts = await getCollection("posts");
	let count = posts.length;
	let pages : any[] = [];

	for(let i = 0; count > 0; count-=3){
		pages.push({params: {page: `dev${i}`},});
		i++;
	}
	return pages;
} 


const anim = {
  old: {
    name: 'test',
	  duration: '0.2s',
	  easing: 'cubic-bezier',
	  fillMode: 'forwards',
	},
	new: {
    name: 'test-reversed',
	  duration: '0.3s',
	  easing: 'cubic-bezier',
	  fillMode: 'backwards',
	}
};
  
const myFade = {
	forwards: anim,
	backwards: anim,
};



const canonicalURL = new URL(Astro.url);

const pageNumber = parseInt(canonicalURL.pathname.replace(/^[^\d]+/g, ''));
const startPoint = pageNumber * 3;
const endPoint = startPoint + 3;
console.log(canonicalURL.pathname.replace(/^[^\d]+/g, ''));
console.log(startPoint);
console.log(endPoint);

const posts = await getCollection("posts");

// Determines whether we should display the previous page button.
const draw_prev_button = (pageNumber > 0);
// deterimine whether we should display the next page button
const draw_next_button = (endPoint <= posts.length);



type Props = {
post_list: CollectionEntry<'posts'>[];
}

---
 
 <Layout title = "Devlog">
	<Sidebar selected = "devlog"></Sidebar>
	<div class = "main-content" transition:animate={myFade}>
		{
			posts.reverse()
			.slice(
				startPoint,
				endPoint
				)
				.map((p) => <DevlogEntry post={p}/>)
			}
		{draw_prev_button && <p>Prev page</p>}
		{draw_next_button && <p>Next page</p>}
	</div>
</Layout>